<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="static/bootstrap/css/bootstrap.min.css">

    <style>
        @font-face {
            font-family: "now";
            src: url("static/font/Now-Regular.otf");
        }

        * {
            font-family: now;
            color: #313131;
        }

        .form-control:disabled, .form-control[readonly] {
            background-color: transparent;
        }
    </style>

    <title>rESCMA (Villacura-Herr & Kenner, 2020)</title>
</head>
<body>
<div class="container mt-5">
    <div class="row">
        <div class="col-12 col-lg-8">
            <div class="text-center">
                <a>
                    <img src="static/images/rESCMA logo trans.png" class="w-50">
                </a>
            </div>
            <h1 class="h3 mt-5">
                <span>Data input</span>
                <span class="float-right">
                    <a href="index.html" class="btn btn-dark">Single</a>
                    <a href="bulk.html" class="btn btn-outline-dark">Bulk</a>
                </span>
            </h1>
            <div class="border-top border-dark" style="border-width: medium!important;"></div>


            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="form-group text-center">
                        <label for="base_effect_size">Convert from</label>
                        <select id="base_effect_size" class="custom-select">
                            <option value="correlation_coefficient">Correlation Coefficient ( r )</option>
                            <option value="standardized_mean_difference">Standardized Mean Difference ( d )</option>
                            <option value="odds_ratio">Odds Ratio ( OR )</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group text-center">
                        <label for="effect_input">Effect size</label>
                        <input id="effect_input" class="form-control text-center" type="text">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group text-center">
                        <label for="sample_size">Sample size</label>
                        <input id="sample_size" class="form-control text-center" type="text">
                    </div>
                </div>
            </div>

            <h1 class="h3 mt-5 pb-0">
                <span>Data output</span>
                <button id="copy_string" class="btn btn-dark rounded-pill px-4 float-right" data-clipboard-text="">Copy Results</button>
            </h1>
            <div class="border-top border-dark" style="border-width: medium!important;"></div>

            <div class="mt-4">
                <div class="row">
                    <label for="output_correlation_coefficient" class="col-6 col-sm-7 col-md-8 col-lg-9 col-form-label">Correlation
                        coefficient ( r
                        )</label>
                    <div class="col-6 col-sm-5 col-md-4 col-lg-3">
                        <input type="text" readonly="" class="form-control form-control-sm text-center"
                               id="output_correlation_coefficient">
                    </div>
                </div>

                <div class="row justify-content-center">
                    <label for="output_variance_of_r" class="col-6 col-sm-7 col-md-8 col-lg-9 col-form-label">Variance
                        of r</label>
                    <div class="col-6 col-sm-5 col-md-4 col-lg-3">
                        <input type="text" readonly="" class="form-control form-control-sm text-center" id="output_variance_of_r">
                    </div>
                </div>

                <div class="row justify-content-center">
                    <label for="output_standardized_mean_difference"
                           class="col-6 col-sm-7 col-md-8 col-lg-9 col-form-label">Standardized mean
                        difference (
                        d
                        )</label>
                    <div class="col-6 col-sm-5 col-md-4 col-lg-3">
                        <input type="text" readonly="" class="form-control form-control-sm text-center"
                               id="output_standardized_mean_difference">
                    </div>
                </div>

                <div class="row justify-content-center">
                    <label for="output_variance_of_d" class="col-6 col-sm-7 col-md-8 col-lg-9 col-form-label">Variance
                        of d</label>
                    <div class="col-6 col-sm-5 col-md-4 col-lg-3">
                        <input type="text" readonly="" class="form-control form-control-sm text-center" id="output_variance_of_d">
                    </div>
                </div>

                <div class="row justify-content-center">
                    <label for="output_odds_ratio" class="col-6 col-sm-7 col-md-8 col-lg-9 col-form-label">Odds Ratio (
                        OR )</label>
                    <div class="col-6 col-sm-5 col-md-4 col-lg-3">
                        <input type="text" readonly="" class="form-control form-control-sm text-center" id="output_odds_ratio">
                    </div>
                </div>

                <div class="row justify-content-center">
                    <label for="output_natural_logarith_of_the_odds_ratio"
                           class="col-6 col-sm-7 col-md-8 col-lg-9 col-form-label">Natural Logarithm
                        of
                        the
                        Odds
                        Ratio ( LnOR )</label>
                    <div class="col-6 col-sm-5 col-md-4 col-lg-3">
                        <input type="text" readonly="" class="form-control form-control-sm text-center"
                               id="output_natural_logarith_of_the_odds_ratio">
                    </div>
                </div>

                <div class="row">
                    <label for="output_variance_of_lnor" class="col-6 col-sm-7 col-md-8 col-lg-9 col-form-label">Variance
                        of LnOR</label>
                    <div class="col-6 col-sm-5 col-md-4 col-lg-3">
                        <input type="text" readonly="" class="form-control form-control-sm text-center"
                               id="output_variance_of_lnor">
                    </div>
                </div>
            </div>

            <footer class="mt-5">
                <small>Villacura-Herr, C. & Kenner, N. (2020). rESCMA: A brief summary on effect size conversion
                    for meta-analysis.<br><i>OSF Preprints</i>. <a href="http://doi.org/10.31219/osf.io/8np9d">doi.org/10.31219/osf.io/8np9d</a></small>
            </footer>
        </div>
        <div class="col-4 d-none d-lg-block text-center mt-5">
            <img src="static/images/ForestPlot_Trans.png" class="w-100">
        </div>


    </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="static/jquery/jquery-3.5.1.slim.min.js"></script>
<script src="static/popper/popper.min.js"></script>
<script src="static/bootstrap/js/bootstrap.min.js"></script>

<!-- Clipboard.js -->
<script src="static/clipboard/clipboard.min.js"></script>

<script>
    new ClipboardJS('.btn');

    var base_effect_size = document.getElementById('base_effect_size');

    var effect_input = document.getElementById('effect_input');
    var sample_size = document.getElementById('sample_size');

    var output_correlation_coefficient = document.getElementById('output_correlation_coefficient');
    var output_variance_of_r = document.getElementById('output_variance_of_r');
    var output_standardized_mean_difference = document.getElementById('output_standardized_mean_difference');
    var output_natural_logarith_of_the_odds_ratio = document.getElementById('output_natural_logarith_of_the_odds_ratio');
    var output_variance_of_d = document.getElementById('output_variance_of_d');
    var output_odds_ratio = document.getElementById('output_odds_ratio');
    var output_variance_of_lnor = document.getElementById('output_variance_of_lnor');

    var copy_string = document.getElementById('copy_string');

    function recalculate(changed_affect_size = false) {
        if (effect_input.value !== '') {
            switch (base_effect_size.value) {
                case 'correlation_coefficient':
                    if (changed_affect_size === true) {
                        effect_input.value = output_correlation_coefficient.value;
                    }
                    output_correlation_coefficient.value = effect_input.value;
                    output_variance_of_r.value = (((1 - (effect_input.value * effect_input.value)) * (1 - (effect_input.value * effect_input.value))) / ((sample_size.value) - 1)).toFixed(10);
                    output_natural_logarith_of_the_odds_ratio.value = (1.81379936423434 * ((2 * output_correlation_coefficient.value) / (Math.sqrt(1 - (output_correlation_coefficient.value * output_correlation_coefficient.value))))).toFixed(10);
                    output_standardized_mean_difference.value = ((output_natural_logarith_of_the_odds_ratio.value) * 0.551328895421756).toFixed(10);
                    output_variance_of_d.value = ((4 * output_variance_of_r.value) / ((1 - (output_correlation_coefficient.value * output_correlation_coefficient.value)) ** 3)).toFixed(10);
                    output_odds_ratio.value = (Math.exp(output_natural_logarith_of_the_odds_ratio.value)).toFixed(10);
                    output_variance_of_lnor.value = (output_variance_of_d.value * ((3.14159265359 * 3.14159265359) / 3)).toFixed(10);
                    break;

                case 'standardized_mean_difference':
                    if (changed_affect_size === true) {
                        effect_input.value = output_standardized_mean_difference.value;
                    }
                    output_correlation_coefficient.value = ((effect_input.value) / (Math.sqrt((effect_input.value * effect_input.value) + 4))).toFixed(10);
                    output_variance_of_r.value = (((1 - (output_correlation_coefficient.value * output_correlation_coefficient.value)) * (1 - (output_correlation_coefficient.value * output_correlation_coefficient.value))) / ((sample_size.value) - 1)).toFixed(10);
                    output_standardized_mean_difference.value = effect_input.value;
                    output_natural_logarith_of_the_odds_ratio.value = (1.81379936423434 * ((2 * output_correlation_coefficient.value) / (Math.sqrt(1 - (output_correlation_coefficient.value * output_correlation_coefficient.value))))).toFixed(10);
                    output_variance_of_d.value = ((4 * output_variance_of_r.value) / ((1 - (output_correlation_coefficient.value * output_correlation_coefficient.value)) * (1 - (output_correlation_coefficient.value * output_correlation_coefficient.value)) * (1 - (output_correlation_coefficient.value * output_correlation_coefficient.value)))).toFixed(10);
                    output_odds_ratio.value = (Math.exp(output_natural_logarith_of_the_odds_ratio.value)).toFixed(10);
                    output_variance_of_lnor.value = (output_variance_of_d.value * ((3.14159265359 * 3.14159265359) / 3)).toFixed(10);
                    break;

                case 'odds_ratio':
                    if (changed_affect_size === true) {
                        effect_input.value = output_odds_ratio.value;
                    }
                    output_correlation_coefficient.value = (((output_natural_logarith_of_the_odds_ratio.value * 0.551328895421756)) / Math.sqrt((output_natural_logarith_of_the_odds_ratio.value * 0.551328895421756) * (output_natural_logarith_of_the_odds_ratio.value * 0.551328895421756) + 4)).toFixed(10);
                    output_variance_of_r.value = (((1 - (output_correlation_coefficient.value * output_correlation_coefficient.value)) * (1 - (output_correlation_coefficient.value * output_correlation_coefficient.value))) / ((sample_size.value) - 1)).toFixed(10);
                    output_natural_logarith_of_the_odds_ratio.value = Math.log(effect_input.value).toFixed(10);
                    output_standardized_mean_difference.value = ((output_natural_logarith_of_the_odds_ratio.value) * 0.551328895421756).toFixed(10);
                    output_variance_of_d.value = ((4 * output_variance_of_r.value) / ((1 - (output_correlation_coefficient.value * output_correlation_coefficient.value)) ** 3)).toFixed(10);
                    output_odds_ratio.value = (Math.exp(output_natural_logarith_of_the_odds_ratio.value)).toFixed(10);
                    output_variance_of_lnor.value = (output_variance_of_d.value * ((3.14159265359 * 3.14159265359) / 3)).toFixed(10);
                    break;
            }
            copy_string.setAttribute('data-clipboard-text', `<table><tr><th>r</th><th>VAR_r</th><th>d</th><th>VAR_d</th><th>OR</th><th>LnOR</th><th>VAR_LnOR</th></tr><tr><td>${output_correlation_coefficient.value}</td><td>${output_variance_of_r.value}</td><td>${output_standardized_mean_difference.value}</td><td>${output_variance_of_d.value}</td><td>${output_odds_ratio.value}</td><td>${output_natural_logarith_of_the_odds_ratio.value}</td><td>${output_variance_of_lnor.value}</td></tr></table>`);
        }
    }

    effect_input.oninput = function () {
        recalculate()
    }
    sample_size.oninput = function () {
        recalculate()
    }
    base_effect_size.oninput = function () {
        recalculate(true)
    }

</script>
</body>
</html>
